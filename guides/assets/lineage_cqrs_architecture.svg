<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4a5568"/>
    </marker>
    <linearGradient id="writeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.2"/>
      <stop offset="100%" style="stop-color:#667eea;stop-opacity:0.05"/>
    </linearGradient>
    <linearGradient id="readGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#48bb78;stop-opacity:0.2"/>
      <stop offset="100%" style="stop-color:#48bb78;stop-opacity:0.05"/>
    </linearGradient>
  </defs>

  <!-- Write Side Background -->
  <rect x="20" y="20" width="760" height="270" rx="8" fill="url(#writeGrad)" stroke="#667eea" stroke-width="2"/>
  <text x="40" y="50" font-family="Inter, system-ui, sans-serif" font-size="16" font-weight="600" fill="#667eea">WRITE SIDE</text>

  <!-- Evolution Process -->
  <rect x="60" y="70" width="180" height="60" rx="6" fill="#fff" stroke="#4a5568" stroke-width="1.5"/>
  <text x="150" y="95" font-family="Inter, system-ui, sans-serif" font-size="13" font-weight="500" fill="#2d3748" text-anchor="middle">Evolution Process</text>
  <text x="150" y="115" font-family="monospace" font-size="10" fill="#718096" text-anchor="middle">neuroevolution_server</text>

  <!-- Arrow: Evolution to Behaviour -->
  <line x1="150" y1="130" x2="150" y2="155" stroke="#4a5568" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="160" y="148" font-family="monospace" font-size="9" fill="#718096">emit(event)</text>

  <!-- Behaviour Box -->
  <rect x="60" y="160" width="300" height="110" rx="6" fill="#fff" stroke="#667eea" stroke-width="2"/>
  <text x="210" y="185" font-family="Inter, system-ui, sans-serif" font-size="13" font-weight="600" fill="#667eea" text-anchor="middle">neuroevolution_lineage_events</text>
  <text x="210" y="202" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#718096" text-anchor="middle">(BEHAVIOUR)</text>

  <!-- Callbacks list -->
  <text x="80" y="225" font-family="monospace" font-size="10" fill="#4a5568">init/1</text>
  <text x="80" y="240" font-family="monospace" font-size="10" fill="#4a5568">persist_event/2</text>
  <text x="80" y="255" font-family="monospace" font-size="10" fill="#4a5568">persist_batch/2</text>
  <text x="210" y="225" font-family="monospace" font-size="10" fill="#4a5568">read_stream/3</text>
  <text x="210" y="240" font-family="monospace" font-size="10" fill="#4a5568">subscribe/3</text>
  <text x="210" y="255" font-family="monospace" font-size="10" fill="#4a5568">unsubscribe/3</text>

  <!-- Arrow: Behaviour to Event Store -->
  <line x1="360" y1="215" x2="430" y2="215" stroke="#4a5568" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="395" y="205" font-family="monospace" font-size="9" fill="#718096" text-anchor="middle">async</text>

  <!-- Event Store -->
  <rect x="440" y="160" width="300" height="110" rx="6" fill="#fff" stroke="#4a5568" stroke-width="1.5"/>
  <text x="590" y="190" font-family="Inter, system-ui, sans-serif" font-size="13" font-weight="500" fill="#2d3748" text-anchor="middle">Event Store</text>
  <text x="590" y="210" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#718096" text-anchor="middle">(streams by entity type)</text>

  <!-- Stream examples -->
  <text x="470" y="235" font-family="monospace" font-size="9" fill="#4a5568">individual-{id}</text>
  <text x="470" y="250" font-family="monospace" font-size="9" fill="#4a5568">species-{id}</text>
  <text x="600" y="235" font-family="monospace" font-size="9" fill="#4a5568">population-{id}</text>
  <text x="600" y="250" font-family="monospace" font-size="9" fill="#4a5568">coalition-{id}</text>

  <!-- Read Side Background -->
  <rect x="20" y="310" width="760" height="270" rx="8" fill="url(#readGrad)" stroke="#48bb78" stroke-width="2"/>
  <text x="40" y="340" font-family="Inter, system-ui, sans-serif" font-size="16" font-weight="600" fill="#48bb78">READ SIDE</text>

  <!-- Projections -->
  <rect x="60" y="360" width="200" height="80" rx="6" fill="#fff" stroke="#48bb78" stroke-width="1.5"/>
  <text x="160" y="390" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#2d3748" text-anchor="middle">Lineage Tree</text>
  <text x="160" y="408" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#718096" text-anchor="middle">Projection</text>
  <text x="160" y="428" font-family="monospace" font-size="9" fill="#48bb78" text-anchor="middle">ancestry + breeding</text>

  <rect x="300" y="360" width="200" height="80" rx="6" fill="#fff" stroke="#48bb78" stroke-width="1.5"/>
  <text x="400" y="390" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#2d3748" text-anchor="middle">Fitness Trajectory</text>
  <text x="400" y="408" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#718096" text-anchor="middle">Projection</text>
  <text x="400" y="428" font-family="monospace" font-size="9" fill="#48bb78" text-anchor="middle">performance over time</text>

  <rect x="540" y="360" width="200" height="80" rx="6" fill="#fff" stroke="#48bb78" stroke-width="1.5"/>
  <text x="640" y="390" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#2d3748" text-anchor="middle">Mutation History</text>
  <text x="640" y="408" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#718096" text-anchor="middle">Projection</text>
  <text x="640" y="428" font-family="monospace" font-size="9" fill="#48bb78" text-anchor="middle">genetic changes</text>

  <!-- Subscribe arrows from Event Store to Projections -->
  <path d="M 590 270 L 590 295 L 160 295 L 160 360" stroke="#718096" stroke-width="1" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 590 270 L 590 295 L 400 295 L 400 360" stroke="#718096" stroke-width="1" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 590 270 L 590 295 L 640 295 L 640 360" stroke="#718096" stroke-width="1" stroke-dasharray="4,2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="320" y="308" font-family="monospace" font-size="9" fill="#718096">subscribe</text>

  <!-- Read Models -->
  <rect x="200" y="480" width="400" height="70" rx="6" fill="#fff" stroke="#48bb78" stroke-width="2"/>
  <text x="400" y="510" font-family="Inter, system-ui, sans-serif" font-size="13" font-weight="500" fill="#2d3748" text-anchor="middle">Read Models</text>
  <text x="400" y="530" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#718096" text-anchor="middle">(optimized for fast queries - no joins, no calculations)</text>

  <!-- Arrows from Projections to Read Models -->
  <line x1="160" y1="440" x2="160" y2="460" stroke="#48bb78" stroke-width="1.5"/>
  <line x1="160" y1="460" x2="280" y2="480" stroke="#48bb78" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="440" x2="400" y2="480" stroke="#48bb78" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="640" y1="440" x2="640" y2="460" stroke="#48bb78" stroke-width="1.5"/>
  <line x1="640" y1="460" x2="520" y2="480" stroke="#48bb78" stroke-width="1.5" marker-end="url(#arrowhead)"/>
</svg>