<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="resourceGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4ade80;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#22c55e;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="taskGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#60a5fa;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="distGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f472b6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowGreen" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#22c55e" />
    </marker>
    <marker id="arrowBlue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#3b82f6" />
    </marker>
    <marker id="arrowPink" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ec4899" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="550" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-size="22" font-weight="bold" fill="#1e293b">Cross-Silo Signal Routing</text>
  <text x="450" y="50" text-anchor="middle" font-size="12" fill="#64748b">Cooperative Communication Between LC Silos via lc_cross_silo</text>

  <!-- Resource Silo -->
  <g transform="translate(50, 150)">
    <rect x="0" y="0" width="200" height="200" rx="12" fill="white" stroke="#22c55e" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="200" height="40" rx="12" fill="url(#resourceGrad)"/>
    <rect x="0" y="28" width="200" height="12" fill="url(#resourceGrad)"/>
    <text x="100" y="27" text-anchor="middle" font-size="14" font-weight="bold" fill="white">Resource Silo</text>

    <!-- Outgoing signals -->
    <g transform="translate(10, 55)">
      <text x="0" y="12" font-size="10" font-weight="600" fill="#166534">Outgoing Signals:</text>
      <text x="10" y="28" font-size="9" fill="#166534">→ pressure_signal (0-1)</text>
      <text x="10" y="42" font-size="9" fill="#166534">→ max_evals_per_individual</text>
      <text x="10" y="56" font-size="9" fill="#166534">→ recommended_batch_size</text>
      <text x="10" y="70" font-size="9" fill="#166534">→ should_simplify (0-1)</text>
      <text x="10" y="84" font-size="9" fill="#166534">→ offload_preference (0-1)</text>
      <text x="10" y="98" font-size="9" fill="#166534">→ local_capacity (0-1)</text>
    </g>

    <!-- Incoming signals -->
    <g transform="translate(10, 155)">
      <text x="0" y="12" font-size="10" font-weight="600" fill="#166534">Incoming Signals:</text>
      <text x="10" y="28" font-size="9" fill="#166534">← exploration_boost</text>
      <text x="10" y="42" font-size="9" fill="#166534">← network_load_contribution</text>
    </g>
  </g>

  <!-- Task Silo -->
  <g transform="translate(350, 80)">
    <rect x="0" y="0" width="200" height="220" rx="12" fill="white" stroke="#3b82f6" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="200" height="40" rx="12" fill="url(#taskGrad)"/>
    <rect x="0" y="28" width="200" height="12" fill="url(#taskGrad)"/>
    <text x="100" y="27" text-anchor="middle" font-size="14" font-weight="bold" fill="white">Task Silo</text>

    <!-- Outgoing signals -->
    <g transform="translate(10, 55)">
      <text x="0" y="12" font-size="10" font-weight="600" fill="#1e40af">Outgoing Signals:</text>
      <text x="10" y="28" font-size="9" fill="#1e40af">→ exploration_boost (0-1)</text>
      <text x="10" y="42" font-size="9" fill="#1e40af">→ desired_evals_per_individual</text>
      <text x="10" y="56" font-size="9" fill="#1e40af">→ expected_complexity_growth</text>
      <text x="10" y="70" font-size="9" fill="#1e40af">→ evaluation_urgency (0-1)</text>
      <text x="10" y="84" font-size="9" fill="#1e40af">→ diversity_need (0-1)</text>
      <text x="10" y="98" font-size="9" fill="#1e40af">→ speciation_pressure (0-1)</text>
    </g>

    <!-- Incoming signals -->
    <g transform="translate(10, 155)">
      <text x="0" y="12" font-size="10" font-weight="600" fill="#1e40af">Incoming Signals:</text>
      <text x="10" y="28" font-size="9" fill="#1e40af">← pressure_signal</text>
      <text x="10" y="42" font-size="9" fill="#1e40af">← max_evals_per_individual</text>
      <text x="10" y="56" font-size="9" fill="#1e40af">← island_diversity_score</text>
    </g>
  </g>

  <!-- Distribution Silo -->
  <g transform="translate(650, 150)">
    <rect x="0" y="0" width="200" height="200" rx="12" fill="white" stroke="#ec4899" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="200" height="40" rx="12" fill="url(#distGrad)"/>
    <rect x="0" y="28" width="200" height="12" fill="url(#distGrad)"/>
    <text x="100" y="27" text-anchor="middle" font-size="14" font-weight="bold" fill="white">Distribution Silo</text>

    <!-- Outgoing signals -->
    <g transform="translate(10, 55)">
      <text x="0" y="12" font-size="10" font-weight="600" fill="#9d174d">Outgoing Signals:</text>
      <text x="10" y="28" font-size="9" fill="#9d174d">→ network_load_contribution</text>
      <text x="10" y="42" font-size="9" fill="#9d174d">→ remote_capacity_available</text>
      <text x="10" y="56" font-size="9" fill="#9d174d">→ island_diversity_score</text>
      <text x="10" y="70" font-size="9" fill="#9d174d">→ migration_activity (0-1)</text>
    </g>

    <!-- Incoming signals -->
    <g transform="translate(10, 125)">
      <text x="0" y="12" font-size="10" font-weight="600" fill="#9d174d">Incoming Signals:</text>
      <text x="10" y="28" font-size="9" fill="#9d174d">← offload_preference</text>
      <text x="10" y="42" font-size="9" fill="#9d174d">← local_capacity</text>
      <text x="10" y="56" font-size="9" fill="#9d174d">← diversity_need</text>
      <text x="10" y="70" font-size="9" fill="#9d174d">← speciation_pressure</text>
    </g>
  </g>

  <!-- Signal flow arrows -->
  <!-- Resource → Task -->
  <path d="M 250 200 Q 300 150 350 180" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="280" y="145" font-size="8" fill="#22c55e">pressure, evals_limit</text>

  <!-- Task → Resource -->
  <path d="M 350 260 Q 300 300 250 280" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="270" y="310" font-size="8" fill="#3b82f6">exploration_boost</text>

  <!-- Task → Distribution -->
  <path d="M 550 180 Q 600 150 650 180" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowPink)"/>
  <text x="580" y="145" font-size="8" fill="#3b82f6">diversity_need</text>

  <!-- Distribution → Task -->
  <path d="M 650 260 Q 600 300 550 260" stroke="#ec4899" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="570" y="310" font-size="8" fill="#ec4899">island_diversity</text>

  <!-- Resource → Distribution -->
  <path d="M 250 320 Q 450 420 650 320" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrowPink)"/>
  <text x="430" y="405" font-size="8" fill="#22c55e">offload_preference, capacity</text>

  <!-- Distribution → Resource -->
  <path d="M 650 350 Q 450 440 250 350" stroke="#ec4899" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="430" y="455" font-size="8" fill="#ec4899">network_load, remote_capacity</text>

  <!-- Cross-Silo Coordinator Box -->
  <g transform="translate(350, 370)">
    <rect x="0" y="0" width="200" height="70" rx="8" fill="#fbbf24" filter="url(#shadow)"/>
    <text x="100" y="22" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e293b">lc_cross_silo</text>
    <text x="100" y="38" text-anchor="middle" font-size="10" fill="#1e293b">Signal Router</text>
    <text x="100" y="52" text-anchor="middle" font-size="9" fill="#1e293b" opacity="0.8">Route validation + decay</text>
    <text x="100" y="64" text-anchor="middle" font-size="9" fill="#1e293b" opacity="0.8">Effective evals computation</text>
  </g>

  <!-- Legend -->
  <g transform="translate(50, 475)">
    <rect x="0" y="0" width="800" height="60" rx="8" fill="white" stroke="#e2e8f0"/>
    <text x="400" y="18" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e293b">Signal Categories</text>

    <g transform="translate(30, 30)">
      <circle cx="8" cy="8" r="6" fill="#22c55e"/>
      <text x="20" y="12" font-size="10" fill="#1e293b">Resource → others: pressure, capacity limits</text>
    </g>

    <g transform="translate(280, 30)">
      <circle cx="8" cy="8" r="6" fill="#3b82f6"/>
      <text x="20" y="12" font-size="10" fill="#1e293b">Task → others: exploration, diversity needs</text>
    </g>

    <g transform="translate(550, 30)">
      <circle cx="8" cy="8" r="6" fill="#ec4899"/>
      <text x="20" y="12" font-size="10" fill="#1e293b">Distribution → others: load, diversity scores</text>
    </g>
  </g>

  <!-- Shared Resource Note -->
  <g transform="translate(50, 70)">
    <rect x="0" y="0" width="300" height="45" rx="6" fill="#fef3c7" stroke="#fbbf24"/>
    <text x="150" y="18" text-anchor="middle" font-size="10" font-weight="600" fill="#92400e">Shared Resource Resolution</text>
    <text x="150" y="32" text-anchor="middle" font-size="9" fill="#92400e">evals_per_individual = min(resource_max, task_desired)</text>
  </g>
</svg>
