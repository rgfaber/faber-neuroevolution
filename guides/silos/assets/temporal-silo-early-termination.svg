<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 500">
  <defs>
    <linearGradient id="evalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e"/>
      <stop offset="100%" style="stop-color:#16a34a"/>
    </linearGradient>
    <linearGradient id="termGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ef4444"/>
      <stop offset="100%" style="stop-color:#dc2626"/>
    </linearGradient>
    <linearGradient id="checkGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#d97706"/>
    </linearGradient>
    <linearGradient id="timeoutGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6"/>
      <stop offset="100%" style="stop-color:#7c3aed"/>
    </linearGradient>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#d97706"/>
    </marker>
    <marker id="arrowPurple2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7c3aed"/>
    </marker>
    <filter id="shadowET" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="850" height="500" fill="#f8fafc"/>

  <!-- Title -->
  <text x="425" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1e293b">Early Termination &amp; Timeout Decision Flow</text>

  <!-- Start: Evaluation Begins -->
  <ellipse cx="80" cy="120" rx="50" ry="25" fill="url(#evalGrad)" stroke="#15803d" stroke-width="2" filter="url(#shadowET)"/>
  <text x="80" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">Start Eval</text>

  <!-- Arrow to Min Steps Check -->
  <path d="M130 120 L180 120" stroke="#16a34a" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- Decision: Min Steps? -->
  <polygon points="260,120 310,90 360,120 310,150" fill="url(#checkGrad)" stroke="#b45309" stroke-width="2" filter="url(#shadowET)"/>
  <text x="310" y="117" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">min_steps</text>
  <text x="310" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">reached?</text>

  <!-- No path (loop back) -->
  <path d="M260 120 L200 120 L200 80 L310 80 L310 90" stroke="#d97706" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="255" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#b45309">No: continue</text>

  <!-- Yes path to fitness check -->
  <path d="M360 120 L420 120" stroke="#16a34a" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <text x="390" y="110" font-family="Arial, sans-serif" font-size="9" fill="#16a34a">Yes</text>

  <!-- Decision: Fitness Check -->
  <polygon points="500,120 560,85 620,120 560,155" fill="url(#checkGrad)" stroke="#b45309" stroke-width="2" filter="url(#shadowET)"/>
  <text x="560" y="113" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">fitness &lt;</text>
  <text x="560" y="127" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">threshold?</text>

  <!-- Yes: Early Termination -->
  <path d="M560 155 L560 200" stroke="#dc2626" stroke-width="2" marker-end="url(#arrowRed)"/>
  <text x="575" y="180" font-family="Arial, sans-serif" font-size="9" fill="#dc2626">Yes</text>

  <rect x="490" y="210" width="140" height="50" rx="8" fill="url(#termGrad)" stroke="#b91c1c" stroke-width="2" filter="url(#shadowET)"/>
  <text x="560" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">EARLY</text>
  <text x="560" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">TERMINATION</text>

  <!-- No: Continue to Timeout Check -->
  <path d="M620 120 L680 120" stroke="#16a34a" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <text x="650" y="110" font-family="Arial, sans-serif" font-size="9" fill="#16a34a">No</text>

  <!-- Decision: Timeout Check -->
  <polygon points="760,120 810,90 850,120 810,150 760,150" fill="url(#timeoutGrad)" stroke="#6d28d9" stroke-width="2" filter="url(#shadowET)"/>
  <text x="805" y="117" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">elapsed &gt;</text>
  <text x="805" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">timeout?</text>

  <!-- Timeout path -->
  <path d="M810 150 L810 200" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrowPurple2)"/>
  <text x="825" y="180" font-family="Arial, sans-serif" font-size="9" fill="#7c3aed">Yes</text>

  <rect x="740" y="210" width="140" height="50" rx="8" fill="url(#timeoutGrad)" stroke="#6d28d9" stroke-width="2" filter="url(#shadowET)"/>
  <text x="810" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">EVALUATION</text>
  <text x="810" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">TIMEOUT</text>

  <!-- No: Continue evaluation -->
  <path d="M760 120 L680 200" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="710" y="165" font-family="Arial, sans-serif" font-size="9" fill="#16a34a">No: continue</text>

  <!-- Continue Evaluation Box -->
  <rect x="620" y="200" width="100" height="40" rx="6" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="1.5"/>
  <text x="670" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0369a1">Continue</text>

  <!-- Loop back from Continue -->
  <path d="M620 220 L590 220 L590 300 L200 300 L200 150 L260 150" stroke="#0ea5e9" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="400" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#0369a1">Next step (loop until episode complete or termination)</text>

  <!-- Bottom section: Event Emission -->
  <rect x="50" y="350" width="750" height="130" rx="8" fill="white" stroke="#cbd5e1" stroke-width="1"/>
  <text x="425" y="375" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1e293b">Events Emitted</text>

  <!-- Early Termination Event -->
  <rect x="80" y="395" width="200" height="70" rx="6" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="180" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#991b1b">early_termination</text>
  <text x="90" y="435" font-family="monospace" font-size="8" fill="#7f1d1d">individual_id, reason</text>
  <text x="90" y="450" font-family="monospace" font-size="8" fill="#7f1d1d">fitness, steps_completed</text>

  <!-- Timeout Event -->
  <rect x="310" y="395" width="200" height="70" rx="6" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="410" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#5b21b6">evaluation_timeout</text>
  <text x="320" y="435" font-family="monospace" font-size="8" fill="#4c1d95">individual_id</text>
  <text x="320" y="450" font-family="monospace" font-size="8" fill="#4c1d95">elapsed_ms, timeout_ms</text>

  <!-- Episode Complete Event -->
  <rect x="540" y="395" width="230" height="70" rx="6" fill="#dcfce7" stroke="#16a34a" stroke-width="1"/>
  <text x="655" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">episode_completed (if successful)</text>
  <text x="550" y="435" font-family="monospace" font-size="8" fill="#14532d">individual_id, length, target</text>
  <text x="550" y="450" font-family="monospace" font-size="8" fill="#14532d">fitness, generation</text>

  <!-- Legend -->
  <text x="80" y="490" font-family="Arial, sans-serif" font-size="10" fill="#64748b">
    <tspan font-weight="bold">Training Velocity Impact:</tspan> Early termination saves 30-70% of wasted compute on hopeless individuals
  </text>
</svg>
