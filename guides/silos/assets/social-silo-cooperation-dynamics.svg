<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 520">
  <defs>
    <linearGradient id="coopGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#34d399"/>
      <stop offset="100%" style="stop-color:#10b981"/>
    </linearGradient>
    <linearGradient id="defectGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f87171"/>
      <stop offset="100%" style="stop-color:#ef4444"/>
    </linearGradient>
    <linearGradient id="coalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#a78bfa"/>
      <stop offset="100%" style="stop-color:#8b5cf6"/>
    </linearGradient>
    <linearGradient id="kinGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fbbf24"/>
      <stop offset="100%" style="stop-color:#f59e0b"/>
    </linearGradient>
    <filter id="shadowCoop" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.2"/>
    </filter>
    <marker id="coopArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
    </marker>
    <marker id="defArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="850" height="520" fill="#f8fafc"/>

  <!-- Title -->
  <text x="425" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1e293b">Social Dynamics: Cooperation, Coalitions &amp; Kin Selection</text>

  <!-- Payoff Matrix Section -->
  <rect x="40" y="55" width="260" height="200" rx="10" fill="white" stroke="#10b981" stroke-width="2" filter="url(#shadowCoop)"/>
  <rect x="40" y="55" width="260" height="30" rx="10" fill="url(#coopGrad)"/>
  <rect x="40" y="75" width="260" height="10" fill="url(#coopGrad)"/>
  <text x="170" y="77" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Payoff Matrix (Prisoner's Dilemma)</text>

  <!-- Matrix grid -->
  <rect x="130" y="100" width="70" height="25" fill="#dcfce7" stroke="#10b981"/>
  <rect x="200" y="100" width="70" height="25" fill="#fee2e2" stroke="#ef4444"/>
  <text x="165" y="117" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">B: Coop</text>
  <text x="235" y="117" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#dc2626">B: Defect</text>

  <rect x="60" y="125" width="70" height="35" fill="#dcfce7" stroke="#10b981"/>
  <text x="95" y="147" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">A: Coop</text>
  <rect x="130" y="125" width="70" height="35" fill="#bbf7d0" stroke="#10b981"/>
  <text x="165" y="142" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#166534">R, R</text>
  <text x="165" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#166534">Reward</text>
  <rect x="200" y="125" width="70" height="35" fill="#fecaca" stroke="#ef4444"/>
  <text x="235" y="142" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#dc2626">S, T</text>
  <text x="235" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#dc2626">Sucker</text>

  <rect x="60" y="160" width="70" height="35" fill="#fee2e2" stroke="#ef4444"/>
  <text x="95" y="182" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#dc2626">A: Defect</text>
  <rect x="130" y="160" width="70" height="35" fill="#fecaca" stroke="#ef4444"/>
  <text x="165" y="177" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#dc2626">T, S</text>
  <text x="165" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#dc2626">Tempt</text>
  <rect x="200" y="160" width="70" height="35" fill="#fca5a5" stroke="#ef4444"/>
  <text x="235" y="177" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#dc2626">P, P</text>
  <text x="235" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#dc2626">Punish</text>

  <text x="170" y="215" text-anchor="middle" font-family="monospace" font-size="9" fill="#64748b">T > R > P > S</text>
  <text x="170" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#64748b">Temptation > Reward > Punishment > Sucker</text>
  <text x="170" y="245" text-anchor="middle" font-family="monospace" font-size="9" fill="#3b82f6">R=+0.2, P=-0.3, T=+0.3, S=-0.1</text>

  <!-- Reputation Section -->
  <rect x="320" y="55" width="220" height="200" rx="10" fill="white" stroke="#3b82f6" stroke-width="2" filter="url(#shadowCoop)"/>
  <rect x="320" y="55" width="220" height="30" rx="10" fill="#3b82f6"/>
  <rect x="320" y="75" width="220" height="10" fill="#3b82f6"/>
  <text x="430" y="77" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Reputation System</text>

  <!-- Reputation bar chart -->
  <text x="335" y="105" font-family="Arial, sans-serif" font-size="9" fill="#1e40af">Score Range: -1.0 to +1.0</text>

  <rect x="345" y="120" width="20" height="60" fill="#dcfce7" stroke="#10b981"/>
  <rect x="345" y="130" width="20" height="50" fill="#10b981"/>
  <text x="355" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#166534">+0.8</text>
  <text x="355" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#64748b">Helper</text>

  <rect x="385" y="120" width="20" height="60" fill="#dcfce7" stroke="#10b981"/>
  <rect x="385" y="145" width="20" height="35" fill="#10b981"/>
  <text x="395" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#166534">+0.4</text>
  <text x="395" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#64748b">Coop</text>

  <rect x="425" y="120" width="20" height="60" fill="#e5e7eb" stroke="#6b7280"/>
  <rect x="425" y="150" width="20" height="30" fill="#6b7280" opacity="0.5"/>
  <text x="435" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#64748b">0.0</text>
  <text x="435" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#64748b">Neutral</text>

  <rect x="465" y="120" width="20" height="60" fill="#fee2e2" stroke="#ef4444"/>
  <rect x="465" y="120" width="20" height="25" fill="#ef4444"/>
  <text x="475" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#dc2626">-0.3</text>
  <text x="475" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#64748b">Defect</text>

  <rect x="505" y="120" width="20" height="60" fill="#fee2e2" stroke="#ef4444"/>
  <rect x="505" y="120" width="20" height="45" fill="#ef4444"/>
  <text x="515" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#dc2626">-0.7</text>
  <text x="515" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#64748b">Aggr</text>

  <text x="335" y="225" font-family="Arial, sans-serif" font-size="9" fill="#1e40af">Reputation affects:</text>
  <text x="345" y="240" font-family="monospace" font-size="8" fill="#1e40af">• Partner selection (high rep preferred)</text>
  <text x="345" y="252" font-family="monospace" font-size="8" fill="#1e40af">• Coalition admission (min rep required)</text>

  <!-- Coalition Section -->
  <rect x="560" y="55" width="250" height="200" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2" filter="url(#shadowCoop)"/>
  <rect x="560" y="55" width="250" height="30" rx="10" fill="url(#coalGrad)"/>
  <rect x="560" y="75" width="250" height="10" fill="url(#coalGrad)"/>
  <text x="685" y="77" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Coalition Formation</text>

  <!-- Coalition diagram -->
  <circle cx="620" cy="130" r="25" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
  <circle cx="610" cy="125" r="8" fill="#8b5cf6"/>
  <circle cx="630" cy="125" r="8" fill="#8b5cf6"/>
  <circle cx="620" cy="140" r="8" fill="#8b5cf6"/>
  <text x="620" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Coalition A</text>
  <text x="620" y="175" text-anchor="middle" font-family="monospace" font-size="8" fill="#5b21b6">3 members</text>

  <circle cx="720" cy="130" r="35" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
  <circle cx="705" cy="115" r="8" fill="#8b5cf6"/>
  <circle cx="735" cy="115" r="8" fill="#8b5cf6"/>
  <circle cx="705" cy="145" r="8" fill="#8b5cf6"/>
  <circle cx="735" cy="145" r="8" fill="#8b5cf6"/>
  <circle cx="720" cy="130" r="8" fill="#7c3aed"/>
  <text x="720" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Coalition B</text>
  <text x="720" y="185" text-anchor="middle" font-family="monospace" font-size="8" fill="#5b21b6">5 members (leader)</text>

  <text x="575" y="210" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Formation reasons:</text>
  <text x="585" y="225" font-family="monospace" font-size="8" fill="#5b21b6">defense | resource | breeding</text>
  <text x="575" y="243" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Fitness bonus: +30% for members</text>

  <!-- Kin Selection Section -->
  <rect x="40" y="275" width="400" height="110" rx="10" fill="white" stroke="#f59e0b" stroke-width="2" filter="url(#shadowCoop)"/>
  <rect x="40" y="275" width="400" height="30" rx="10" fill="url(#kinGrad)"/>
  <rect x="40" y="295" width="400" height="10" fill="url(#kinGrad)"/>
  <text x="240" y="297" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Kin Selection (Hamilton's Rule)</text>

  <!-- Hamilton's rule formula -->
  <text x="60" y="330" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#b45309">Hamilton's Rule: rB > C</text>
  <text x="60" y="350" font-family="Arial, sans-serif" font-size="10" fill="#92400e">r = relatedness coefficient (0.5 for siblings)</text>
  <text x="60" y="365" font-family="Arial, sans-serif" font-size="10" fill="#92400e">B = benefit to recipient, C = cost to helper</text>

  <!-- Kin tree diagram -->
  <circle cx="320" cy="325" r="15" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="320" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#92400e">Parent</text>

  <line x1="305" y1="340" x2="280" y2="360" stroke="#f59e0b" stroke-width="1.5"/>
  <line x1="335" y1="340" x2="360" y2="360" stroke="#f59e0b" stroke-width="1.5"/>

  <circle cx="280" cy="370" r="12" fill="#fed7aa" stroke="#f59e0b" stroke-width="2"/>
  <text x="280" y="374" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#92400e">Sib A</text>
  <circle cx="360" cy="370" r="12" fill="#fed7aa" stroke="#f59e0b" stroke-width="2"/>
  <text x="360" y="374" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#92400e">Sib B</text>

  <text x="320" y="350" text-anchor="middle" font-family="monospace" font-size="9" fill="#b45309">r=0.5</text>
  <text x="400" y="370" font-family="monospace" font-size="9" fill="#b45309">r=0.5 between siblings</text>

  <!-- Social Network Section -->
  <rect x="460" y="275" width="350" height="110" rx="10" fill="white" stroke="#3b82f6" stroke-width="2" filter="url(#shadowCoop)"/>
  <rect x="460" y="275" width="350" height="30" rx="10" fill="#3b82f6"/>
  <rect x="460" y="295" width="350" height="10" fill="#3b82f6"/>
  <text x="635" y="297" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Social Network Structure</text>

  <!-- Network diagram -->
  <circle cx="520" cy="345" r="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
  <circle cx="560" cy="325" r="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
  <circle cx="600" cy="355" r="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
  <circle cx="560" cy="365" r="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>
  <circle cx="510" cy="370" r="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2"/>

  <line x1="520" y1="345" x2="560" y2="325" stroke="#3b82f6" stroke-width="1"/>
  <line x1="520" y1="345" x2="560" y2="365" stroke="#3b82f6" stroke-width="1"/>
  <line x1="560" y1="325" x2="600" y2="355" stroke="#3b82f6" stroke-width="1"/>
  <line x1="560" y1="365" x2="600" y2="355" stroke="#3b82f6" stroke-width="1"/>
  <line x1="520" y1="345" x2="510" y2="370" stroke="#3b82f6" stroke-width="1"/>
  <line x1="510" y1="370" x2="560" y2="365" stroke="#3b82f6" stroke-width="1"/>

  <text x="650" y="330" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Network density: 0.67</text>
  <text x="650" y="350" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Hierarchy steepness: 0.4</text>
  <text x="650" y="370" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Interaction frequency: 12/gen</text>

  <!-- Control Flow Box -->
  <rect x="40" y="400" width="770" height="105" rx="8" fill="white" stroke="#cbd5e1" stroke-width="1"/>
  <text x="425" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1e293b">Social Control Loop (per generation)</text>

  <text x="60" y="450" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">1.</tspan> Pair individuals for interactions
  </text>
  <text x="60" y="470" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">2.</tspan> Resolve cooperation/defection
  </text>
  <text x="60" y="490" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">3.</tspan> Update reputations
  </text>
  <text x="290" y="450" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">4.</tspan> Check kin helping (Hamilton's rule)
  </text>
  <text x="290" y="470" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">5.</tspan> Maintain/dissolve coalitions
  </text>
  <text x="290" y="490" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">6.</tspan> Form new coalitions if beneficial
  </text>
  <text x="560" y="450" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">7.</tspan> Apply fitness bonuses/penalties
  </text>
  <text x="560" y="470" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">8.</tspan> Decay reputations
  </text>
  <text x="560" y="490" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">9.</tspan> Emit social events
  </text>
</svg>
