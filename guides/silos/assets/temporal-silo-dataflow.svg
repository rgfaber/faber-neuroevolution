<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 520">
  <defs>
    <linearGradient id="tempGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#a78bfa"/>
      <stop offset="100%" style="stop-color:#8b5cf6"/>
    </linearGradient>
    <linearGradient id="engineGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#2563eb"/>
    </linearGradient>
    <linearGradient id="taskGrad3" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#5BA3E0"/>
      <stop offset="100%" style="stop-color:#4A90D9"/>
    </linearGradient>
    <linearGradient id="econGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e"/>
      <stop offset="100%" style="stop-color:#16a34a"/>
    </linearGradient>
    <marker id="arrowPurple4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/>
    </marker>
    <marker id="arrowBlue4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2563eb"/>
    </marker>
    <marker id="arrowGreen2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a"/>
    </marker>
    <filter id="shadowTemp2" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="520" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1e293b">Temporal Silo Integration &amp; Dataflow</text>

  <!-- Evaluation Engine Box -->
  <rect x="40" y="60" width="200" height="170" rx="10" fill="white" stroke="#2563eb" stroke-width="2" filter="url(#shadowTemp2)"/>
  <rect x="40" y="60" width="200" height="30" rx="10" fill="url(#engineGrad)"/>
  <rect x="40" y="80" width="200" height="10" fill="url(#engineGrad)"/>
  <text x="140" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Evaluation Engine</text>

  <text x="55" y="110" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Provides:</text>
  <text x="55" y="125" font-family="monospace" font-size="9" fill="#1e40af">episode_lengths[]</text>
  <text x="55" y="140" font-family="monospace" font-size="9" fill="#1e40af">reaction_times[]</text>
  <text x="55" y="155" font-family="monospace" font-size="9" fill="#1e40af">fitness_history[]</text>
  <text x="55" y="170" font-family="monospace" font-size="9" fill="#1e40af">evaluation_times[]</text>
  <text x="55" y="190" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Consumes:</text>
  <text x="55" y="205" font-family="monospace" font-size="9" fill="#1e40af">timeout, episode_target</text>
  <text x="55" y="220" font-family="monospace" font-size="9" fill="#1e40af">reaction_limit</text>

  <!-- Temporal Silo Box -->
  <rect x="300" y="55" width="300" height="200" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2" filter="url(#shadowTemp2)"/>
  <rect x="300" y="55" width="300" height="35" rx="10" fill="url(#tempGrad2)"/>
  <rect x="300" y="80" width="300" height="10" fill="url(#tempGrad2)"/>
  <text x="450" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">Temporal Silo</text>

  <text x="315" y="110" font-family="Arial, sans-serif" font-size="10" fill="#6b21a8">get_temporal_params()</text>
  <text x="315" y="128" font-family="Arial, sans-serif" font-size="10" fill="#6b21a8">should_terminate_early(fitness)</text>
  <text x="315" y="146" font-family="Arial, sans-serif" font-size="10" fill="#6b21a8">check_timeout(elapsed_ms)</text>
  <text x="315" y="164" font-family="Arial, sans-serif" font-size="10" fill="#6b21a8">record_episode(id, length)</text>
  <text x="315" y="182" font-family="Arial, sans-serif" font-size="10" fill="#6b21a8">record_reaction_time(id, ms)</text>

  <!-- L0 Components -->
  <rect x="480" y="105" width="105" height="25" rx="4" fill="#c4b5fd" opacity="0.3" stroke="#8b5cf6"/>
  <text x="532" y="122" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#5b21b6">episode control</text>
  <rect x="480" y="135" width="105" height="25" rx="4" fill="#c4b5fd" opacity="0.3" stroke="#8b5cf6"/>
  <text x="532" y="152" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#5b21b6">timeout mgmt</text>
  <rect x="480" y="165" width="105" height="25" rx="4" fill="#c4b5fd" opacity="0.3" stroke="#8b5cf6"/>
  <text x="532" y="182" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#5b21b6">early termination</text>

  <!-- Cross-silo notes -->
  <rect x="315" y="210" width="270" height="35" rx="4" fill="#fef3c7" stroke="#f59e0b"/>
  <text x="450" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#b45309">Cross-silo: stagnation_severity, computation_budget</text>

  <!-- Task Silo Box -->
  <rect x="660" y="60" width="200" height="100" rx="10" fill="white" stroke="#4A90D9" stroke-width="2" filter="url(#shadowTemp2)"/>
  <rect x="660" y="60" width="200" height="30" rx="10" fill="url(#taskGrad3)"/>
  <rect x="660" y="80" width="200" height="10" fill="url(#taskGrad3)"/>
  <text x="760" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Task Silo</text>

  <text x="675" y="110" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Sends:</text>
  <text x="675" y="125" font-family="monospace" font-size="9" fill="#1e40af">stagnation_severity</text>
  <text x="675" y="140" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Receives:</text>
  <text x="675" y="155" font-family="monospace" font-size="9" fill="#1e40af">time_pressure</text>

  <!-- Economic Silo Box -->
  <rect x="660" y="180" width="200" height="100" rx="10" fill="white" stroke="#16a34a" stroke-width="2" filter="url(#shadowTemp2)"/>
  <rect x="660" y="180" width="200" height="30" rx="10" fill="url(#econGrad)"/>
  <rect x="660" y="200" width="200" height="10" fill="url(#econGrad)"/>
  <text x="760" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Economic Silo</text>

  <text x="675" y="230" font-family="Arial, sans-serif" font-size="10" fill="#166534">Sends:</text>
  <text x="675" y="245" font-family="monospace" font-size="9" fill="#166534">computation_budget</text>
  <text x="675" y="260" font-family="Arial, sans-serif" font-size="10" fill="#166534">Receives:</text>
  <text x="675" y="275" font-family="monospace" font-size="9" fill="#166534">episode_efficiency</text>

  <!-- Individuals Box -->
  <rect x="300" y="310" width="300" height="90" rx="10" fill="white" stroke="#f97316" stroke-width="2" filter="url(#shadowTemp2)"/>
  <rect x="300" y="310" width="300" height="30" rx="10" fill="#f97316"/>
  <rect x="300" y="330" width="300" height="10" fill="#f97316"/>
  <text x="450" y="332" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Individuals Under Evaluation</text>

  <text x="315" y="360" font-family="Arial, sans-serif" font-size="10" fill="#c2410c">Temporal parameters applied:</text>
  <text x="315" y="375" font-family="monospace" font-size="9" fill="#c2410c">evaluation_timeout_ms, reaction_time_limit_ms</text>
  <text x="315" y="390" font-family="monospace" font-size="9" fill="#c2410c">early_termination_fitness, episode_length_target</text>

  <!-- Event Bus Box -->
  <rect x="660" y="310" width="200" height="90" rx="10" fill="white" stroke="#db2777" stroke-width="2" filter="url(#shadowTemp2)"/>
  <rect x="660" y="310" width="200" height="30" rx="10" fill="#ec4899"/>
  <rect x="660" y="330" width="200" height="10" fill="#ec4899"/>
  <text x="760" y="332" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Event Bus</text>

  <text x="675" y="360" font-family="Arial, sans-serif" font-size="9" fill="#9d174d">evaluation_timeout</text>
  <text x="675" y="375" font-family="Arial, sans-serif" font-size="9" fill="#9d174d">early_termination</text>
  <text x="675" y="390" font-family="Arial, sans-serif" font-size="9" fill="#9d174d">convergence_detected</text>

  <!-- Arrows -->
  <!-- Engine to Temporal -->
  <path d="M240 140 L290 140" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowBlue4)"/>
  <text x="265" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#2563eb">metrics</text>

  <!-- Temporal to Engine -->
  <path d="M290 180 L240 180" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowPurple4)"/>
  <text x="265" y="198" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#8b5cf6">params</text>

  <!-- Task to Temporal -->
  <path d="M660 110 L610 130" stroke="#4A90D9" stroke-width="1.5" marker-end="url(#arrowBlue4)"/>
  <text x="640" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#4A90D9">stagnation</text>

  <!-- Economic to Temporal -->
  <path d="M660 230 L610 180" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen2)"/>
  <text x="640" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#16a34a">budget</text>

  <!-- Temporal to Individuals -->
  <path d="M450 255 L450 300" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowPurple4)"/>
  <text x="480" y="280" text-anchor="start" font-family="Arial, sans-serif" font-size="9" fill="#8b5cf6">params</text>

  <!-- Temporal to Events -->
  <path d="M600 200 L660 330" stroke="#db2777" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="635" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#db2777">events</text>

  <!-- Control Flow Box -->
  <rect x="40" y="420" width="820" height="85" rx="8" fill="white" stroke="#cbd5e1" stroke-width="1"/>
  <text x="450" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1e293b">Temporal Control Loop (per evaluation)</text>

  <text x="60" y="468" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">1.</tspan> Check reaction time budget
  </text>
  <text x="60" y="488" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">2.</tspan> Check early termination condition
  </text>
  <text x="270" y="468" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">3.</tspan> Check evaluation timeout
  </text>
  <text x="270" y="488" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">4.</tspan> Record episode metrics on completion
  </text>
  <text x="530" y="468" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">5.</tspan> Compute convergence signals
  </text>
  <text x="530" y="488" font-family="Arial, sans-serif" font-size="10" fill="#334155">
    <tspan font-weight="bold">6.</tspan> Emit temporal events
  </text>
</svg>
