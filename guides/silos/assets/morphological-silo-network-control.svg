<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 480">
  <defs>
    <linearGradient id="networkGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#a78bfa"/>
      <stop offset="100%" style="stop-color:#8b5cf6"/>
    </linearGradient>
    <linearGradient id="pruneGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ef4444"/>
      <stop offset="100%" style="stop-color:#dc2626"/>
    </linearGradient>
    <linearGradient id="growGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e"/>
      <stop offset="100%" style="stop-color:#16a34a"/>
    </linearGradient>
    <linearGradient id="constraintGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#d97706"/>
    </linearGradient>
    <marker id="growArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a"/>
    </marker>
    <marker id="pruneArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
    </marker>
    <filter id="shadowNet" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="850" height="480" fill="#f8fafc"/>

  <!-- Title -->
  <text x="425" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1e293b">Network Structure Control &amp; Pruning</text>

  <!-- Before Network (Bloated) -->
  <rect x="40" y="60" width="230" height="200" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2" filter="url(#shadowNet)"/>
  <text x="155" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#5b21b6">Before (Unconstrained)</text>

  <!-- Network nodes - bloated -->
  <circle cx="80" cy="140" r="10" fill="#a78bfa" stroke="#7c3aed" stroke-width="2"/>
  <circle cx="80" cy="180" r="10" fill="#a78bfa" stroke="#7c3aed" stroke-width="2"/>
  <circle cx="80" cy="220" r="10" fill="#a78bfa" stroke="#7c3aed" stroke-width="2"/>
  <text x="80" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7c3aed">Input</text>

  <!-- Hidden layer 1 -->
  <circle cx="130" cy="120" r="8" fill="#c4b5fd" stroke="#a78bfa"/>
  <circle cx="130" cy="150" r="8" fill="#c4b5fd" stroke="#a78bfa"/>
  <circle cx="130" cy="180" r="8" fill="#fee2e2" stroke="#dc2626" stroke-dasharray="2,1"/>
  <circle cx="130" cy="210" r="8" fill="#fee2e2" stroke="#dc2626" stroke-dasharray="2,1"/>
  <circle cx="130" cy="240" r="8" fill="#c4b5fd" stroke="#a78bfa"/>

  <!-- Hidden layer 2 -->
  <circle cx="180" cy="130" r="8" fill="#c4b5fd" stroke="#a78bfa"/>
  <circle cx="180" cy="160" r="8" fill="#fee2e2" stroke="#dc2626" stroke-dasharray="2,1"/>
  <circle cx="180" cy="190" r="8" fill="#c4b5fd" stroke="#a78bfa"/>
  <circle cx="180" cy="220" r="8" fill="#fee2e2" stroke="#dc2626" stroke-dasharray="2,1"/>

  <!-- Output -->
  <circle cx="230" cy="160" r="10" fill="#a78bfa" stroke="#7c3aed" stroke-width="2"/>
  <circle cx="230" cy="200" r="10" fill="#a78bfa" stroke="#7c3aed" stroke-width="2"/>
  <text x="230" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7c3aed">Output</text>

  <!-- Weak connections (dashed, red) -->
  <line x1="90" y1="140" x2="122" y2="180" stroke="#fecaca" stroke-width="1" stroke-dasharray="3,2"/>
  <line x1="90" y1="180" x2="122" y2="210" stroke="#fecaca" stroke-width="1" stroke-dasharray="3,2"/>
  <line x1="138" y1="180" x2="172" y2="160" stroke="#fecaca" stroke-width="1" stroke-dasharray="3,2"/>
  <line x1="138" y1="210" x2="172" y2="220" stroke="#fecaca" stroke-width="1" stroke-dasharray="3,2"/>

  <!-- Strong connections -->
  <line x1="90" y1="140" x2="122" y2="120" stroke="#7c3aed" stroke-width="2"/>
  <line x1="90" y1="180" x2="122" y2="150" stroke="#7c3aed" stroke-width="2"/>
  <line x1="138" y1="120" x2="172" y2="130" stroke="#7c3aed" stroke-width="2"/>
  <line x1="138" y1="150" x2="172" y2="190" stroke="#7c3aed" stroke-width="2"/>
  <line x1="188" y1="130" x2="220" y2="160" stroke="#7c3aed" stroke-width="2"/>
  <line x1="188" y1="190" x2="220" y2="200" stroke="#7c3aed" stroke-width="2"/>

  <!-- Metrics -->
  <text x="55" y="265" font-family="monospace" font-size="8" fill="#dc2626">neurons: 13 (4 orphan)</text>
  <text x="55" y="275" font-family="monospace" font-size="8" fill="#dc2626">connections: 14 (4 weak)</text>
  <text x="55" y="285" font-family="monospace" font-size="8" fill="#dc2626">efficiency: 0.42</text>

  <!-- Arrow showing pruning -->
  <path d="M280 180 L350 180" stroke="#dc2626" stroke-width="3" marker-end="url(#pruneArrow)"/>
  <text x="315" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#dc2626">PRUNE</text>
  <text x="315" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#dc2626">threshold: 0.1</text>

  <!-- After Network (Efficient) -->
  <rect x="360" y="60" width="200" height="200" rx="10" fill="white" stroke="#22c55e" stroke-width="2" filter="url(#shadowNet)"/>
  <text x="460" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#166534">After (Pruned)</text>

  <!-- Network nodes - efficient -->
  <circle cx="395" cy="140" r="10" fill="#86efac" stroke="#16a34a" stroke-width="2"/>
  <circle cx="395" cy="180" r="10" fill="#86efac" stroke="#16a34a" stroke-width="2"/>
  <circle cx="395" cy="220" r="10" fill="#86efac" stroke="#16a34a" stroke-width="2"/>

  <!-- Hidden layer -->
  <circle cx="445" cy="130" r="8" fill="#bbf7d0" stroke="#22c55e"/>
  <circle cx="445" cy="170" r="8" fill="#bbf7d0" stroke="#22c55e"/>
  <circle cx="445" cy="210" r="8" fill="#bbf7d0" stroke="#22c55e"/>

  <!-- Hidden layer 2 -->
  <circle cx="495" cy="150" r="8" fill="#bbf7d0" stroke="#22c55e"/>
  <circle cx="495" cy="190" r="8" fill="#bbf7d0" stroke="#22c55e"/>

  <!-- Output -->
  <circle cx="540" cy="160" r="10" fill="#86efac" stroke="#16a34a" stroke-width="2"/>
  <circle cx="540" cy="200" r="10" fill="#86efac" stroke="#16a34a" stroke-width="2"/>

  <!-- Strong connections only -->
  <line x1="405" y1="140" x2="437" y2="130" stroke="#16a34a" stroke-width="2"/>
  <line x1="405" y1="180" x2="437" y2="170" stroke="#16a34a" stroke-width="2"/>
  <line x1="405" y1="220" x2="437" y2="210" stroke="#16a34a" stroke-width="2"/>
  <line x1="453" y1="130" x2="487" y2="150" stroke="#16a34a" stroke-width="2"/>
  <line x1="453" y1="170" x2="487" y2="150" stroke="#16a34a" stroke-width="2"/>
  <line x1="453" y1="210" x2="487" y2="190" stroke="#16a34a" stroke-width="2"/>
  <line x1="503" y1="150" x2="530" y2="160" stroke="#16a34a" stroke-width="2"/>
  <line x1="503" y1="190" x2="530" y2="200" stroke="#16a34a" stroke-width="2"/>

  <!-- Metrics -->
  <text x="375" y="265" font-family="monospace" font-size="8" fill="#16a34a">neurons: 9 (0 orphan)</text>
  <text x="375" y="275" font-family="monospace" font-size="8" fill="#16a34a">connections: 8 (all strong)</text>
  <text x="375" y="285" font-family="monospace" font-size="8" fill="#16a34a">efficiency: 0.78 (+86%)</text>

  <!-- Size Limits Box -->
  <rect x="600" y="60" width="220" height="200" rx="10" fill="white" stroke="#f59e0b" stroke-width="2" filter="url(#shadowNet)"/>
  <rect x="600" y="60" width="220" height="30" rx="10" fill="url(#constraintGrad)"/>
  <rect x="600" y="80" width="220" height="10" fill="url(#constraintGrad)"/>
  <text x="710" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">Size Constraints</text>

  <text x="615" y="110" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#b45309">Limits:</text>
  <text x="615" y="125" font-family="monospace" font-size="9" fill="#92400e">max_neurons: 100</text>
  <text x="615" y="140" font-family="monospace" font-size="9" fill="#92400e">max_connections: 500</text>
  <text x="615" y="155" font-family="monospace" font-size="9" fill="#92400e">min_neurons: 5</text>

  <text x="615" y="180" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#b45309">Penalties:</text>
  <text x="615" y="195" font-family="monospace" font-size="9" fill="#92400e">complexity_penalty: 0.01</text>
  <text x="615" y="210" font-family="monospace" font-size="9" fill="#92400e">size_exponent: 1.5</text>

  <text x="615" y="235" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#b45309">Rates:</text>
  <text x="615" y="250" font-family="monospace" font-size="9" fill="#92400e">pruning_threshold: 0.1</text>

  <!-- Bottom: Efficiency Formula -->
  <rect x="40" y="310" width="780" height="150" rx="8" fill="white" stroke="#cbd5e1" stroke-width="1"/>
  <text x="430" y="335" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1e293b">Complexity Penalty Formula</text>

  <!-- Formula -->
  <text x="60" y="370" font-family="Arial, sans-serif" font-size="12" fill="#475569">Adjusted Fitness = Raw Fitness - (complexity_penalty * params^size_exponent / 1000)</text>

  <!-- Example -->
  <rect x="60" y="390" width="350" height="55" rx="6" fill="#fef3c7" stroke="#f59e0b"/>
  <text x="80" y="410" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#b45309">Example (large network):</text>
  <text x="80" y="425" font-family="monospace" font-size="9" fill="#92400e">fitness=0.80, params=500, penalty=0.01, exp=1.5</text>
  <text x="80" y="438" font-family="monospace" font-size="9" fill="#92400e">adjusted = 0.80 - (0.01 * 500^1.5 / 1000) = 0.69</text>

  <rect x="430" y="390" width="350" height="55" rx="6" fill="#dcfce7" stroke="#22c55e"/>
  <text x="450" y="410" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">Example (small network):</text>
  <text x="450" y="425" font-family="monospace" font-size="9" fill="#14532d">fitness=0.75, params=100, penalty=0.01, exp=1.5</text>
  <text x="450" y="438" font-family="monospace" font-size="9" fill="#14532d">adjusted = 0.75 - (0.01 * 100^1.5 / 1000) = 0.74</text>

  <!-- Legend -->
  <text x="430" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">Small efficient networks are preferred over large bloated ones with similar raw fitness</text>
</svg>
