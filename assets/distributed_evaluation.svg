<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 400">
  <defs>
    <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4B5563"/>
    </marker>
    <linearGradient id="coordGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1E40AF;stop-opacity:1"/>
      <stop offset="100%" style="stop-color:#3B82F6;stop-opacity:1"/>
    </linearGradient>
    <linearGradient id="workerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#059669;stop-opacity:1"/>
      <stop offset="100%" style="stop-color:#34D399;stop-opacity:1"/>
    </linearGradient>
    <filter id="shadow2" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="350" y="30" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#1F2937">Distributed Batch Evaluation</text>

  <!-- Coordinator Node -->
  <rect x="40" y="60" width="180" height="280" rx="10" fill="url(#coordGradient)" filter="url(#shadow2)"/>
  <text x="130" y="85" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Coordinator Node</text>

  <!-- Population box -->
  <rect x="55" y="100" width="150" height="50" rx="5" fill="#DBEAFE" stroke="#93C5FD" stroke-width="2"/>
  <text x="130" y="122" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#1E40AF">Population</text>
  <text x="130" y="140" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#3B82F6">[1, 2, 3, 4, 5, 6]</text>

  <!-- Split batch -->
  <rect x="55" y="165" width="150" height="40" rx="5" fill="#EFF6FF" stroke="#93C5FD" stroke-width="1"/>
  <text x="130" y="190" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1E40AF">split_batch/2</text>

  <!-- Batches -->
  <rect x="55" y="220" width="45" height="30" rx="3" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
  <text x="77" y="240" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#92400E">[1,2]</text>

  <rect x="107" y="220" width="45" height="30" rx="3" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
  <text x="129" y="240" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#92400E">[3,4]</text>

  <rect x="159" y="220" width="45" height="30" rx="3" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
  <text x="181" y="240" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#92400E">[5,6]</text>

  <!-- Local eval -->
  <rect x="55" y="270" width="150" height="50" rx="5" fill="#D1FAE5" stroke="#6EE7B7" stroke-width="2"/>
  <text x="130" y="292" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#065F46">eval [1,2]</text>
  <text x="130" y="308" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#059669">(local parallel)</text>

  <!-- Worker Node 1 -->
  <rect x="300" y="100" width="160" height="120" rx="10" fill="url(#workerGradient)" filter="url(#shadow2)"/>
  <text x="380" y="125" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Worker Node 1</text>

  <rect x="315" y="145" width="130" height="55" rx="5" fill="#ECFDF5" stroke="#A7F3D0" stroke-width="2"/>
  <text x="380" y="170" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#065F46">eval [3,4]</text>
  <text x="380" y="188" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#059669">(parallel)</text>

  <!-- Worker Node 2 -->
  <rect x="300" y="240" width="160" height="120" rx="10" fill="url(#workerGradient)" filter="url(#shadow2)"/>
  <text x="380" y="265" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Worker Node 2</text>

  <rect x="315" y="285" width="130" height="55" rx="5" fill="#ECFDF5" stroke="#A7F3D0" stroke-width="2"/>
  <text x="380" y="310" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#065F46">eval [5,6]</text>
  <text x="380" y="328" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#059669">(parallel)</text>

  <!-- erpc arrows -->
  <line x1="220" y1="235" x2="295" y2="175" stroke="#4B5563" stroke-width="2" marker-end="url(#arrowhead2)"/>
  <text x="245" y="195" font-family="Arial, sans-serif" font-size="10" fill="#6B7280" transform="rotate(-25, 245, 195)">erpc</text>

  <line x1="220" y1="245" x2="295" y2="315" stroke="#4B5563" stroke-width="2" marker-end="url(#arrowhead2)"/>
  <text x="245" y="295" font-family="Arial, sans-serif" font-size="10" fill="#6B7280" transform="rotate(25, 245, 295)">erpc</text>

  <!-- Results Collection -->
  <rect x="520" y="160" width="150" height="130" rx="10" fill="#F3F4F6" stroke="#D1D5DB" stroke-width="2" filter="url(#shadow2)"/>
  <text x="595" y="185" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#374151">Collect Results</text>

  <rect x="535" y="200" width="120" height="30" rx="3" fill="#D1FAE5" stroke="#059669" stroke-width="1"/>
  <text x="595" y="220" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#065F46">Results [1,2] ✓</text>

  <rect x="535" y="235" width="120" height="30" rx="3" fill="#D1FAE5" stroke="#059669" stroke-width="1"/>
  <text x="595" y="255" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#065F46">Results [3,4] ✓</text>

  <rect x="535" y="270" width="120" height="30" rx="3" fill="#D1FAE5" stroke="#059669" stroke-width="1"/>
  <text x="595" y="290" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#065F46">Results [5,6] ✓</text>

  <!-- Return arrows -->
  <path d="M 445 172 C 480 172, 480 225, 515 225" fill="none" stroke="#6B7280" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowhead2)"/>
  <path d="M 445 312 C 480 312, 480 285, 515 285" fill="none" stroke="#6B7280" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowhead2)"/>
  <line x1="220" y1="295" x2="515" y2="215" stroke="#6B7280" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowhead2)"/>

  <!-- Legend -->
  <rect x="520" y="320" width="150" height="60" rx="5" fill="#F9FAFB" stroke="#E5E7EB" stroke-width="1"/>
  <text x="595" y="340" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#374151">Communication</text>
  <line x1="535" y1="355" x2="565" y2="355" stroke="#4B5563" stroke-width="2" marker-end="url(#arrowhead2)"/>
  <text x="580" y="359" font-family="Arial, sans-serif" font-size="9" fill="#6B7280">erpc call</text>
  <line x1="535" y1="370" x2="565" y2="370" stroke="#6B7280" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowhead2)"/>
  <text x="580" y="374" font-family="Arial, sans-serif" font-size="9" fill="#6B7280">results</text>
</svg>
